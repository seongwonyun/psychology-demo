// src/app/utils/diagnosisCatalog.js

// 자리별 허용 문자 규칙 (P/N, E/D, S/I, M/U, A/L)
const SLOT_RULES = [
  new Set(["p", "n"]),
  new Set(["e", "d"]),
  new Set(["s", "i"]),
  new Set(["m", "u"]),
  new Set(["a", "l"]),
];

// 입력을 PERMA 5자리 규칙에 맞게 정규화(대소문자/공백 무시, 자리별 허용문자만 순서대로 5개 추출)
function normalizePermaCode(input) {
  if (!input) return null;
  const raw = String(input).toLowerCase().replace(/\s+/g, "");
  const picked = [];
  for (let i = 0; i < raw.length && picked.length < 5; i++) {
    const ch = raw[i];
    const slot = picked.length;
    if (SLOT_RULES[slot].has(ch)) picked.push(ch);
  }
  if (picked.length !== 5) return null;
  return picked.join("");
}

// ✅ 교정/정제 후 최종 맵
export const DIAGNOSIS_MAP = {
  // P E S M A / L (P로 시작하는 16개)
  pesma: {
    name: "세계를 품은 완벽한 여행자",
    desc: "마음의 모든 영역이 조화롭게 펼쳐진 이상적인 여행자. 긍정의 햇살을 받으며 깊이 몰입하고 동행자들과 따뜻한 추억을 쌓으며 여행의 의미를 온전히 느끼고 매 순간 성취감을 맛보는 상태",
  },
  pesml: {
    name: "여유로운 휴양지 탐험가",
    desc: "밝은 에너지로 사람들과 어울리며 여행에 깊이 빠져들고 의미를 찾아가지만 아직 자신만의 특별한 성취나 목표 달성을 경험하지 못한 여유로운 휴양 여행자",
  },
  pesua: {
    name: "모험을 즐기는 액티브 트래블러",
    desc: "긍정적 에너지로 사람들과 함께 역동적인 활동에 몰입하며 성취감도 느끼지만 아직 여행의 더 깊은 철학적 의미나 인생의 목적을 찾지 못한 활발한 모험 여행자",
  },
  pesul: {
    name: "자유로운 백패커",
    desc: "현재의 여행을 충분히 즐기며 동행자들과 좋은 관계를 유지하고 깊이 몰입하지만 장기적인 여행 목표나 인생의 방향성을 아직 설정하지 못한 자유분방한 배낭여행자",
  },
  pedma: {
    name: "고독한 성찰 여행자",
    desc: "개인적 성장과 의미 탐구에 집중하며 성취감도 느끼지만 다른 여행자들과의 교류나 사회적 연결을 피하며 혼자만의 깊은 여행을 추구하는 상태",
  },
  pedml: {
    name: "조용한 힐링 여행자",
    desc: "긍정적 마음으로 여행에 몰입하며 의미를 찾아가지만 사람들과의 깊은 교류나 특별한 성취 경험 없이 조용히 자신만의 치유 여행을 하는 상태",
  },
  pedua: {
    name: "도전하는 솔로 트래블러",
    desc: "긍정적 에너지로 여행에 몰입하며 개인적 성취를 추구하지만 동행자와의 교류나 여행의 깊은 의미 탐구보다는 개인적 목표 달성에 집중하는 독립적인 여행자",
  },
  pedul: {
    name: "자유영혼 원더러",
    desc: "긍정적이고 현재에 몰입하는 자유로운 여행자이지만 깊은 인간관계나 의미 탐구 성취 경험 없이 그저 자유롭게 떠돌아다니는 것을 좋아하는 상태",
  },
  pdsma: {
    name: "사교적인 리조트 여행자",
    desc: "밝고 사교적이며 의미있는 여행을 추구하고 성취감도 느끼지만 여행 중 깊은 몰입이나 집중보다는 가벼운 즐거움을 선호하는 리조트형 여행자",
  },
  pdsml: {
    name: "파티 러버 트래블러",
    desc: "긍정적이고 사교적인 성격으로 여행의 의미를 어느 정도 찾아가지만 깊이 있는 몰입이나 개인적 성취보다는 즐거운 파티와 만남을 중심으로 하는 여행자",
  },
  pdsua: {
    name: "인스타그래머블 트래블러",
    desc: "긍정적이고 사교적이며 성취감을 느끼지만 여행의 깊은 의미나 진정한 몰입보다는 화려한 경험과 성과를 중시하는 트렌디한 여행자",
  },
  pdsul: {
    name: "트렌드 팔로워 여행자",
    desc: "밝고 사교적이지만 여행의 깊은 몰입이나 의미 개인적 성취보다는 유행하는 여행지를 따라다니며 표면적인 즐거움만을 추구하는 상태",
  },
  pdima: {
    name: "인플루언서 여행자",
    desc: "긍정적이고 성취지향적이지만 동행자와의 깊은 교류나 여행에 대한 진정한 몰입보다는 개인적 성과에 집중하는 인플루언서형 여행자",
  },
  pdiml: {
    name: "가벼운 관광객",
    desc: "긍정적 성격이지만 여행에서 깊은 몰입이나 의미있는 관계 개인적 성취보다는 가벼운 관광과 구경을 선호하는 여행 초보자",
  },
  pdiua: {
    name: "목표 지향적 여행자",
    desc: "긍정적이고 성취를 추구하지만 깊은 인간관계나 여행에 대한 몰입 의미 탐구보다는 개인적 목표 달성에만 집중하는 여행자",
  },
  pdiul: {
    name: "여행 루키",
    desc: "긍정적이지만 아직 여행의 다양한 경험들 - 깊은 몰입이나 의미있는 관계 개인적 성취를 경험해보지 못한 여행 초보자",
  },

  // N E S M A / L (N으로 시작하는 S-계열 8개)
  nesma: {
    name: "마음의 여행을 떠나는 순례자",
    desc: "깊이 몰입하고 의미있는 관계를 맺으며 성취도 이루어가지만 내면의 기쁨이나 여행에 대한 순수한 즐거움을 되찾아가는 과정에 있는 성숙한 여행자",
  },
  nesml: {
    name: "마음을 치유하는 가드너",
    desc: "의미있는 동행과 활동을 통해 마음의 정원을 가꾸며 내면의 만족감을 천천히 키워나가는 중인 치유 여행자",
  },
  nesua: {
    name: "자아를 찾는 모험가",
    desc: "활발한 여행 활동과 관계는 유지하지만 내면의 진정한 기쁨과 여행의 깊은 의미를 찾아 떠나는 자아 발견의 여정 중인 여행자",
  },
  nesul: {
    name: "고요한 여행 명상가",
    desc: "깊은 연결과 몰입은 유지하면서 천천히 내적 만족감과 여행에 대한 새로운 의미를 재발견해나가는 조용한 성찰 여행자",
  },
  nedma: {
    name: "균형을 찾는 여행 아티스트",
    desc: "의미있는 관계와 성취는 이루었지만 일상의 작은 기쁨과 여행에 대한 순수한 몰입감을 되찾아가는 여행 예술가",
  },
  nedml: {
    name: "지혜를 모으는 여행 수집가",
    desc: "소중한 관계와 깊은 의미는 간직하면서 새로운 활력과 에너지를 차근차근 쌓아가는 지혜로운 여행자",
  },
  nedua: {
    name: "관계 속에서 성장하는 여행자",
    desc: "소중한 사람들과의 여행 속에서 천천히 내면의 풍요로움과 기쁨을 키워나가는 관계 중심의 여행자",
  },
  nedul: {
    name: "따뜻한 여행 동반자",
    desc: "사랑하는 사람들과의 연결을 가장 소중히 여기며 그 관계 속에서 개인적 성장의 새싹을 틀우는 공동체 여행자",
  },

  // ⚠️ 규칙 위반이던 항목들을 교정하여 I-계열(NDI***)로 편입 (중복은 최초 항목만 채택)
  ndima: {
    // from: nedima / ndisma (충돌 시 최초 항목 nedima 채택)
    name: "고독한 여행 철학자",
    desc: "깊은 목적의식을 가지고 혼자만의 여행을 통해 내면을 단단히 다져가며 성취를 이루어가는 사색적 여행자",
  },
  ndiml: {
    // from: nediml / ndisml (충돌 시 최초 항목 nediml 채택)
    name: "의미를 품은 여행 시인",
    desc: "삶과 여행의 깊은 의미를 간직하며 천천히 다른 영역들을 꽃피워갈 준비를 하는 시적인 여행자",
  },
  ndiua: {
    // from: nediua / ndisua (충돌 시 최초 항목 nediua 채택)
    name: "목표를 향한 여행 순례자",
    desc: "명확한 여행 목표를 가지고 묵묵히 걸어가며 그 여정 속에서 다양한 경험과 깨달음을 쌓아가는 의지적 여행자",
  },
  ndiul: {
    // from: nediul / ndisul (충돌 시 최초 항목 nediul 채택)
    name: "새로운 여행을 꿈꾸는 나그네",
    desc: "인생의 큰 전환점에서 깊은 휴식을 취하며 다음 여행을 위한 에너지와 영감을 모으고 있는 지혜로운 여행자",
  },
};

// ✅ 안전한 조회 헬퍼 — 대소문자/공백 허용 + PERMA 5자리 규칙 검증
export function getDiagnosis(code) {
  const norm = normalizePermaCode(code);
  if (!norm) return null;
  return DIAGNOSIS_MAP[norm] || null;
}
